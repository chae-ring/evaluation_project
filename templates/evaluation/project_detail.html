{% extends "base.html" %}
{% load static %}

{% block title %}프로젝트 상세{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/project_detail.css' %}">
{% endblock %}

{% block content %}
<h1 class="project-title">{{ project.title }}</h1>
<p class="project-desc">{{ project.description }}</p>
<div class="avg-score-block">
  평균 점수: 
  <span class="stars">
    {% for i in "12345" %}
      {% if forloop.counter <= avg_score|floatformat:0 %}
        <span class="star filled">★</span>
      {% else %}
        <span class="star">☆</span>
      {% endif %}
    {% endfor %}
  </span>
  <span class="score-number">{{ avg_score|floatformat:1 }}</span>
</div>

{% if can_vote %}
  {% if user.is_authenticated %}
    {% if user_vote %}
      <p>이미 투표하셨습니다. 점수: {{ user_vote.score }}</p>
      <p><a href="{% url 'project_result' project.id %}">투표 결과 보기</a></p>
    {% else %}
      <form method="post" action="{% url 'project_vote' project.id %}" class="vote-form">
        {% csrf_token %}
        <label for="score">점수 (1~5):</label>
        <input type="number" name="score" min="1" max="5" required />
        <button type="submit" class="btn">투표하기</button>
      </form>
    {% endif %}
  {% else %}
    <p><a href="{% url 'login' %}">로그인</a> 후 투표 가능합니다.</p>
  {% endif %}
{% else %}
  <p>현재 투표 기간이 아닙니다.</p>
{% endif %}
{% endblock %}

